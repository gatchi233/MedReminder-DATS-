<?xml version="1.0" encoding="utf-8" ?>
<pages:AuthPage
    x:Class="MedReminder.Pages.ResidentsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:MedReminder.Pages"
    xmlns:model="clr-namespace:MedReminder.Models"
    xmlns:xct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Title="Residents"
    BackgroundColor="#FFECD1">



    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Logout" Clicked="OnLogoutClicked" />
    </ContentPage.ToolbarItems>

    <ContentPage.Content>
        <Grid Padding="16" RowDefinitions="Auto,*">

            <!-- Search bar + Add button -->
            <Border Grid.Row="0" Padding="8" Margin="0,0,0,12" BackgroundColor="White">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <Border.Stroke>
                    <SolidColorBrush Color="#15616D"/>
                </Border.Stroke>
                
                <Grid ColumnDefinitions="*,Auto">
                    <SearchBar x:Name="NameSearchBar"
                               Placeholder="Search by resident name"
                               Grid.Column="0"
                               TextChanged="OnFilterChanged" />

                    <ImageButton Grid.Column="1"
                                 Source="icons8_adduser_100.png"
                                 WidthRequest="36"
                                 HeightRequest="36"
                                 CornerRadius="18"
                                 Padding="6"
                                 Margin="10,0,0,0"
                                 Clicked="OnAddResidentClicked" />
                </Grid>
            </Border>

            <!-- Residents list -->
            <CollectionView Grid.Row="1"
                            x:Name="ResidentsCollectionView"
                            ItemsSource="{Binding Residents}"
                            SelectionMode="Single"
                            SelectionChanged="OnResidentClicked">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="model:Resident">
                        <Border Margin="0,6,0,6" Padding="16" BackgroundColor="White">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Border.Stroke>
                                <SolidColorBrush Color="#15616D"/>
                            </Border.Stroke>
                        
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="{Binding Name}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#001524" />

                                <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                       Margin="0,6,0,0"
                                       FontSize="13">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Emergency: " FontAttributes="Bold" TextColor="#FF7D00" />
                                            <Span Text="{Binding EmergencyContactName1}" TextColor="#001524" />
                                            <Span Text=" (" TextColor="#001524" />
                                            <Span Text="{Binding EmergencyRelationship1}" TextColor="#001524" />
                                            <Span Text=") " TextColor="#001524" />
                                            <Span Text="{Binding EmergencyContactPhone1}" TextColor="#15616D" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       Margin="0,4,0,0"
                                       FontSize="13">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Doctor: " FontAttributes="Bold" TextColor="#15616D" />
                                            <Span Text="{Binding DoctorName}" TextColor="#001524" />
                                            <Span Text="  " TextColor="#001524" />
                                            <Span Text="{Binding DoctorContact}" TextColor="#15616D" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <HorizontalStackLayout Grid.Row="0" Grid.Column="1"
                                                       Spacing="6"
                                                       HorizontalOptions="End"
                                                       VerticalOptions="Start">

                                    <ImageButton Source="icons8_view_100.png"
                                                 WidthRequest="28"
                                                 HeightRequest="28"
                                                 CornerRadius="14"
                                                 Padding="4"
                                                 Clicked="OnViewResidentClicked"
                                                 CommandParameter="{Binding .}"
                                                 SemanticProperties.Hint="View Resident" />

                                    <ImageButton Source="icons8_edit_100.png"
                                                 WidthRequest="28"
                                                 HeightRequest="28"
                                                 CornerRadius="14"
                                                 Padding="4"
                                                 Clicked="OnEditResidentClicked"
                                                 CommandParameter="{Binding .}"
                                                 SemanticProperties.Hint="Edit Resident" />

                                    <ImageButton Source="icons8_pill_100.png"
                                                 WidthRequest="28"
                                                 HeightRequest="28"
                                                 CornerRadius="14"
                                                 Padding="4"
                                                 Clicked="OnViewMedClicked"
                                                 CommandParameter="{Binding .}"
                                                 SemanticProperties.Hint="View Medications" />

                                    <ImageButton Source="icons8_delete_100.png"
                                                 WidthRequest="28"
                                                 HeightRequest="28"
                                                 BackgroundColor="#ff8fab"
                                                 CornerRadius="14"
                                                 Padding="4"
                                                 Clicked="OnDeleteResidentClicked"
                                                 CommandParameter="{Binding .}"
                                                 SemanticProperties.Hint="Delete Resident" />
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</pages:AuthPage>
