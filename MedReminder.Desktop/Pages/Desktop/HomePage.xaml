<?xml version="1.0" encoding="utf-8" ?>
<pages:AuthPage
    x:Class="MedReminder.Pages.Desktop.HomePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:MedReminder.Pages"
    xmlns:model="clr-namespace:MedReminder.Models"
    Title="Home"
    BackgroundColor="{StaticResource Homepage_Main_Background}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Logout" Clicked="OnLogoutClicked" Priority="1" Order="Primary" />
    </ContentPage.ToolbarItems>

    <Grid Padding="16"
          RowDefinitions="Auto,*"
          RowSpacing="16">

        <!-- ========== Row 0: Search Section (2 columns) ========== -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*,*"
              ColumnSpacing="16">

            <!-- LEFT COLUMN: Search by resident -->
            <Border Grid.Column="0"
                    Stroke="{StaticResource Homepage_Card_Border}"
                    StrokeThickness="1"
                    BackgroundColor="{StaticResource Homepage_Card_Background}"
                    Padding="12">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>

                <Grid RowDefinitions="Auto,Auto" RowSpacing="10">

                    <!-- Header with Help button -->
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                        <Label Text="1. Search by resident"
                               FontAttributes="Bold"
                               FontSize="16"
                               TextColor="{StaticResource Homepage_Font_Primary}"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Search Entry + Buttons -->
                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">

                        <Entry x:Name="ResidentSearchEntry"
                               Grid.Column="0"
                               Placeholder="Search by resident name"
                               PlaceholderColor="{StaticResource Placeholder_Font_Secondary}"
                               TextColor="{StaticResource Homepage_Font_Primary}"
                               ClearButtonVisibility="WhileEditing"
                               ReturnType="Search"
                               Completed="OnResidentSearchClicked" />

                        <!-- Search Button -->
                        <Border Grid.Column="1" StrokeThickness="0" HeightRequest="28" BackgroundColor="{StaticResource Button_Icon_Background}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="4"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="32,Auto" Margin="0">
                                <Image Grid.Column="0" Source="icons8_search_100.png" HeightRequest="16" WidthRequest="16" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Border Grid.Column="1" BackgroundColor="{StaticResource Button_View}" Padding="10,0" StrokeThickness="0">
                                    <Label Text="SEARCH" TextColor="{StaticResource Button_Font_Primary}" FontSize="12" VerticalOptions="Center" FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnResidentSearchClicked"/>
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- Add Button -->
                        <Border Grid.Column="2" StrokeThickness="0" HeightRequest="28" BackgroundColor="{StaticResource Button_Icon_Background}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="4"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="32,Auto" Margin="0">
                                <Image Grid.Column="0" Source="icons8_adduser_100.png" HeightRequest="16" WidthRequest="16" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Border Grid.Column="1" BackgroundColor="{StaticResource Button_Add}" Padding="10,0" StrokeThickness="0">
                                    <Label Text="ADD" TextColor="{StaticResource Button_Font_Primary}" FontSize="12" VerticalOptions="Center" FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnAddResidentClicked"/>
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>
                </Grid>
            </Border>

            <!-- RIGHT COLUMN: Search by day & time -->
            <Border Grid.Column="1"
                    Stroke="{StaticResource Homepage_Card_Border}"
                    StrokeThickness="1"
                    BackgroundColor="{StaticResource Homepage_Card_Background}"
                    Padding="12">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>

                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">

                    <!-- Header -->
                    <Label Grid.Row="0"
                           Text="2. Search by day &amp; time"
                           FontAttributes="Bold"
                           FontSize="16"
                           TextColor="{StaticResource Homepage_Font_Primary}" />

                    <!-- Pickers + Buttons -->
                    <Grid Grid.Row="1"
                          ColumnDefinitions="*,80,80,Auto,Auto"
                          ColumnSpacing="8">

                        <!-- Day Picker -->
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Day" FontSize="11" TextColor="{StaticResource Homepage_Font_Primary}" />
                            <Picker x:Name="DayPicker">
                                <Picker.Items>
                                    <x:String>Mon</x:String>
                                    <x:String>Tue</x:String>
                                    <x:String>Wed</x:String>
                                    <x:String>Thu</x:String>
                                    <x:String>Fri</x:String>
                                    <x:String>Sat</x:String>
                                    <x:String>Sun</x:String>
                                </Picker.Items>
                            </Picker>
                        </VerticalStackLayout>

                        <!-- Hour Picker -->
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Hour" FontSize="11" TextColor="{StaticResource Homepage_Font_Primary}" />
                            <Picker x:Name="HourPicker">
                                <Picker.Items>
                                    <x:String>0</x:String>
                                    <x:String>1</x:String>
                                    <x:String>2</x:String>
                                    <x:String>3</x:String>
                                    <x:String>4</x:String>
                                    <x:String>5</x:String>
                                    <x:String>6</x:String>
                                    <x:String>7</x:String>
                                    <x:String>8</x:String>
                                    <x:String>9</x:String>
                                    <x:String>10</x:String>
                                    <x:String>11</x:String>
                                    <x:String>12</x:String>
                                    <x:String>13</x:String>
                                    <x:String>14</x:String>
                                    <x:String>15</x:String>
                                    <x:String>16</x:String>
                                    <x:String>17</x:String>
                                    <x:String>18</x:String>
                                    <x:String>19</x:String>
                                    <x:String>20</x:String>
                                    <x:String>21</x:String>
                                    <x:String>22</x:String>
                                    <x:String>23</x:String>
                                </Picker.Items>
                            </Picker>
                        </VerticalStackLayout>

                        <!-- Min Picker -->
                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Min" FontSize="11" TextColor="{StaticResource Homepage_Font_Primary}" />
                            <Picker x:Name="MinutePicker">
                                <Picker.Items>
                                    <x:String>00</x:String>
                                    <x:String>15</x:String>
                                    <x:String>30</x:String>
                                    <x:String>45</x:String>
                                </Picker.Items>
                            </Picker>
                        </VerticalStackLayout>

                        <!-- Clear Button -->
                        <Border Grid.Column="3" StrokeThickness="0" HeightRequest="28" VerticalOptions="End" Margin="0,0,0,4" BackgroundColor="{StaticResource Button_Icon_Background}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="4"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="32,Auto" Margin="0">
                                <Image Grid.Column="0" Source="icons8_clear_100.png" HeightRequest="16" WidthRequest="16" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Border Grid.Column="1" BackgroundColor="{StaticResource Button_Cancel}" Padding="10,0" StrokeThickness="0">
                                    <Label Text="CLEAR" TextColor="{StaticResource Button_Font_Primary}" FontSize="12" VerticalOptions="Center" FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnClearDayTimeClicked"/>
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- Search Button -->
                        <Border Grid.Column="4" StrokeThickness="0" HeightRequest="28" VerticalOptions="End" Margin="0,0,0,4" BackgroundColor="{StaticResource Button_Icon_Background}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="4"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="32,Auto" Margin="0">
                                <Image Grid.Column="0" Source="icons8_search_100.png" HeightRequest="16" WidthRequest="16" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Border Grid.Column="1" BackgroundColor="{StaticResource Button_View}" Padding="10,0" StrokeThickness="0">
                                    <Label Text="SEARCH" TextColor="{StaticResource Button_Font_Primary}" FontSize="12" VerticalOptions="Center" FontAttributes="Bold"/>
                                </Border>
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnSearchClicked"/>
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>

                    <!-- Tip -->
                    <Label Grid.Row="2"
                           FontSize="10"
                           TextColor="{StaticResource Text_Tip}"
                           Text="Tip: Search by resident, time, or both." />
                </Grid>
            </Border>
        </Grid>

        <!-- ========== Row 1: Medications list ========== -->
        <VerticalStackLayout Grid.Row="1" Spacing="8">

            <Label Text="3. Medications"
                   FontAttributes="Bold"
                   FontSize="18"
                   TextColor="{StaticResource Homepage_Font_Primary}" />

            <CollectionView x:Name="MedList"
                            ItemsSource="{Binding Medications}"
                            SelectionMode="Single"
                            SelectionChanged="OnSelectionChanged">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="model:Medication">
                        <Border Margin="0,4"
                                Padding="12"
                                BackgroundColor="{StaticResource Homepage_Card_Background}"
                                Stroke="{StaticResource Accent_Teal}"
                                StrokeThickness="1">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>

                            <Grid ColumnDefinitions="*,Auto">

                                <!-- LEFT: All medication info -->
                                <VerticalStackLayout Grid.Column="0" Spacing="2">

                                    <!-- Resident Name -->
                                    <Label Text="{Binding ResidentName}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Homepage_Font_Primary}" />

                                    <!-- Medication Name -->
                                    <Label Text="{Binding MedName}"
                                           FontSize="14"
                                           TextColor="{StaticResource Homepage_Font_Primary}" />

                                    <!-- Quantity + Unit -->
                                    <Label FontSize="13" TextColor="{StaticResource Homepage_Font_Primary}">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="Qty: " />
                                                <Span Text="{Binding Quantity}" />
                                                <Span Text=" " />
                                                <Span Text="{Binding QuantityUnit}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>

                                    <!-- Condition/Usage -->
                                    <Label Text="{Binding Usage, StringFormat='For: {0}'}"
                                           FontSize="13"
                                           TextColor="{StaticResource Accent_Teal}" />

                                    <!-- Schedule Summary (days + times) -->
                                    <Label Text="{Binding ScheduleSummary}"
                                           FontSize="11"
                                           TextColor="{StaticResource Text_Tip}" />

                                </VerticalStackLayout>

                                <!-- RIGHT: Time + Completed checkbox -->
                                <VerticalStackLayout Grid.Column="1"
                                                     Spacing="10"
                                                     VerticalOptions="Center"
                                                     HorizontalOptions="End">

                                    <!-- Time badge -->
                                    <Border Padding="10,6"
                                            BackgroundColor="{StaticResource Badge_Time_Background}"
                                            HorizontalOptions="End">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding ReminderTime, StringFormat='{}{0:hh\\:mm}'}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Button_Font_Primary}" />
                                    </Border>

                                    <!-- Completed (bigger tap target) -->
                                    <Border Padding="10,6"
                                            Stroke="{StaticResource Badge_Completed_Border}"
                                            StrokeThickness="1"
                                            BackgroundColor="{StaticResource Badge_Completed_Background}"
                                            HorizontalOptions="End">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>

                                        <HorizontalStackLayout Spacing="8"
                                                               HorizontalOptions="End"
                                                               VerticalOptions="Center">

                                            <CheckBox IsChecked="{Binding IsDone}"
                                                      CheckedChanged="OnDoneCheckedChanged"
                                                      VerticalOptions="Center" />

                                            <Label Text="Completed"
                                                   FontSize="13"
                                                   TextColor="{StaticResource Homepage_Font_Primary}"
                                                   VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                    </Border>

                                </VerticalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>

    </Grid>
</pages:AuthPage>
